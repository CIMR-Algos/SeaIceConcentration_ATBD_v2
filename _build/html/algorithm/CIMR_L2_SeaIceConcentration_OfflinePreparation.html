
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Offline preparations for L2 Sea Ice Concentration (SIC) and Sea Ice Edge (SIED) algorithms for CIMR &#8212; CIMR L2 SIC, SIED, and SIC1H ATBD v2</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/styles.css?v=3437f865" />
    <link rel="stylesheet" type="text/css" href="../_static/watermark.css?v=80f188f4" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'algorithm/CIMR_L2_SeaIceConcentration_OfflinePreparation';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="A Level-2 Sea Ice Concentration (SIC) and Sea Ice Edge (SIED) algorithm for CIMR" href="CIMR_L2_Sea_Ice_Concentration_algorithm.html" />
    <link rel="prev" title="Algorithm Input and Output Data Definition (IODD)" href="../book/algorithm_input_output_data_definition.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../book/intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.jpg" class="logo__image only-light" alt="CIMR L2 SIC, SIED, and SIC1H ATBD v2 - Home"/>
    <script>document.write(`<img src="../_static/logo.jpg" class="logo__image only-dark" alt="CIMR L2 SIC, SIED, and SIC1H ATBD v2 - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../book/intro.html">
                    CIMR L2 SIC, SIED, and SIC1H ATBD
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../book/abstract.html">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/applicable_ref_docs.html">Applicable and Reference Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/acronyms.html">Acronyms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/definitions.html">Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/introduction_purpose_scope.html">Introduction, purpose and scope</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/background_justification_algorithm.html">Background and justification of selected algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/L2_product_definition.html">Level-2 product definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/baseline_algorithm_definition.html">Baseline Algorithm Definition for Sea Ice Concentration (SIC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/baseline_algorithm_definition_SIED.html">Baseline Algorithm Definition for Sea Ice EDge (SIED)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/algorithm_input_output_data_definition.html">Algorithm Input and Output Data Definition (IODD)</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Prototype Implementation (Offline Preparation) (ATBD v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="CIMR_L2_Sea_Ice_Concentration_algorithm.html">Prototype Implementation (SIC and SIED) (ATBD v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="CIMR_L2_Sea_Ice_Concentration_performanceAssessment.html">Prototype Performance Assessment (ATBD v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/roadmap_for_future_atbd_developments.html">Roadmap for future ATBD developments (ATBD v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/references.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/CIMR-Algos/SeaIceConcentration_ATBD_v2" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/algorithm/CIMR_L2_SeaIceConcentration_OfflinePreparation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Offline preparations for L2 Sea Ice Concentration (SIC) and Sea Ice Edge (SIED) algorithms for CIMR</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="offline-preparations-for-l2-sea-ice-concentration-sic-and-sea-ice-edge-sied-algorithms-for-cimr">
<h1>Offline preparations for L2 Sea Ice Concentration (SIC) and Sea Ice Edge (SIED) algorithms for CIMR<a class="headerlink" href="#offline-preparations-for-l2-sea-ice-concentration-sic-and-sea-ice-edge-sied-algorithms-for-cimr" title="Link to this heading">#</a></h1>
<p>This notebook implements a series of “offline” preparation steps for the Level-2 SIC3H and SIED3H algorithm for the CIMR mission.</p>
<p>We refer to the corresponding <a class="reference external" href="https://cimr-algos.github.io/SeaIceConcentration_ATBD/intro.html">ATBD</a> and especially the <a class="reference external" href="https://cimr-algos.github.io/SeaIceConcentration_ATBD/baseline_algorithm_definition.html#baseline-algorithm-definition">Baseline Algorithm Definition</a>.</p>
<p>Generally, <em>offline preparations</em> are steps that are run on a regular basis (e.g. every hours, every day, etc…). They aim at preparing everything needed for the L2 algorithms to run efficiently at once a new L1B file is available. For example, external Auxiliary Data Files (ADFs) can be fetched and pre-processed on an hourly basis by an <em>offline</em> chain, to minimize the waiting time when a new L1B product arrives.</p>
<p>Specifically, this notebook implements the dynamic tuning of the SIC algorithm against a rolling archive of L1B files, as is the case in the EUMETSAT OSI SAF and ESA CCI processing chains. In an operational, the rolling archive gives access to typically 5-10 days of L1B data (full L1B files or subsets of TBs). In this demonstration prototype, we have to use the few simulated L1B files we have.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">reload</span>


<span class="c1"># modules in the L2 Sea Ice Concentration ATBD (v2) contain software code that implement the SIC algorithm</span>
<span class="kn">from</span> <span class="nn">sirrdp</span> <span class="kn">import</span> <span class="n">rrdp_file</span>
<span class="kn">from</span> <span class="nn">pmr_sic</span> <span class="kn">import</span> <span class="n">tiepoints</span> <span class="k">as</span> <span class="n">tp</span>
<span class="kn">from</span> <span class="nn">pmr_sic</span> <span class="kn">import</span> <span class="n">hybrid_algo</span>

<span class="c1"># modules to read CIMR L1B files (for the dynamic tuning against an archive of past L1B files)</span>
<span class="k">if</span> <span class="s1">&#39;/Tools/&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../..&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/Tools/&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">tools</span> <span class="kn">import</span> <span class="n">io_handler</span> <span class="k">as</span> <span class="n">io</span>
<span class="kn">from</span> <span class="nn">tools</span> <span class="kn">import</span> <span class="n">collocation</span> <span class="k">as</span> <span class="n">coll</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># encoder class for writing JSON files</span>
<span class="k">class</span> <span class="nc">MyEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
    <span class="c1"># https://stackoverflow.com/questions/27050108/convert-numpy-type-to-python/27050186#27050186</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">MyEncoder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_parameters docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This cell has a tag &#39;parameters&#39; and is used for the CLI with papermill</span>
<span class="n">l1b_archive_dir</span> <span class="o">=</span> <span class="s1">&#39;../data/input&#39;</span>
<span class="n">out_dir</span> <span class="o">=</span> <span class="s1">&#39;../data/aux&#39;</span>
<span class="n">use_oza_adjust</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">algos</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">algos</span><span class="p">[</span><span class="s1">&#39;KA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;channels&#39;</span><span class="p">:(</span><span class="s1">&#39;tb37v&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37h&#39;</span><span class="p">),</span>  <span class="s1">&#39;target_band&#39;</span><span class="p">:</span><span class="s1">&#39;KA&#39;</span><span class="p">}</span>
<span class="n">algos</span><span class="p">[</span><span class="s1">&#39;CKA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;channels&#39;</span><span class="p">:(</span><span class="s1">&#39;tb06v&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37v&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37h&#39;</span><span class="p">),</span> <span class="s1">&#39;target_band&#39;</span><span class="p">:</span><span class="s1">&#39;C&#39;</span><span class="p">}</span>
<span class="n">algos</span><span class="p">[</span><span class="s1">&#39;KKA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;channels&#39;</span><span class="p">:(</span><span class="s1">&#39;tb19v&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37v&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37h&#39;</span><span class="p">),</span> <span class="s1">&#39;target_band&#39;</span><span class="p">:</span><span class="s1">&#39;KU&#39;</span><span class="p">}</span>


<span class="n">tb_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tb01&#39;</span><span class="p">:</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;tb06&#39;</span><span class="p">:</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;tb10&#39;</span><span class="p">:</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;tb19&#39;</span><span class="p">:</span><span class="s1">&#39;KU&#39;</span><span class="p">,</span><span class="s1">&#39;tb37&#39;</span><span class="p">:</span><span class="s1">&#39;KA&#39;</span><span class="p">,}</span>
<span class="n">rev_tb_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">tb_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">bands_needed</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">algos</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">bands_needed</span> <span class="o">+=</span> <span class="n">algos</span><span class="p">[</span><span class="n">alg</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span>
<span class="n">bands_needed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">tb_dict</span><span class="p">[</span><span class="n">b</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands_needed</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check the input parameters</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The output directory </span><span class="si">{}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out_dir</span><span class="p">))</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">l1b_archive_dir</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The l1b archive directory </span><span class="si">{}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l1b_archive_dir</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>An hybrid dynamic / fixed tuning for the SCEPS Polar Scene 1</strong> The SCEPS Polar Scene 1 (v2.1, early 2024) does not reach to high-enough SICs, its peak is around 92%-94% and there are very few values above 95%. This means we cannot extract TB samples for near-100% SIC conditions with lat-lon box. On the other hand, we know the sea-ice emissivity model used by SCEPS for this version of the scene is tuned against the CCI RRDP (AMSR-E and AMSR2).</p>
<p>We thus go for a hybrid approach (dynamic / fixed) for the tuning of our algorithms:</p>
<ul class="simple">
<li><p>The OW TB samples are selected from the CIMR L1B file, in a lat-lon box over open water conditions.</p></li>
<li><p>The CI TB samples are taken from the CCI RRDP (AMSR-E and AMSR2).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># locate and read the RRDP files</span>
<span class="n">rrdp_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/sirrdp&#39;</span>
<span class="n">area</span> <span class="o">=</span> <span class="s1">&#39;nh&#39;</span>
<span class="n">ow_files</span><span class="p">,</span> <span class="n">ci_files</span> <span class="o">=</span> <span class="n">rrdp_file</span><span class="o">.</span><span class="n">find_rrdp_files</span><span class="p">(</span><span class="n">rrdp_dir</span><span class="p">,</span> <span class="n">area</span><span class="o">=</span><span class="n">area</span><span class="p">,</span> <span class="n">years</span><span class="o">=</span><span class="p">(</span><span class="mi">2007</span><span class="p">,</span> <span class="mi">2013</span><span class="p">,</span> <span class="mi">2018</span><span class="p">))</span>

<span class="n">channels_needed</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">algos</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">channels_needed</span> <span class="o">+=</span> <span class="n">algos</span><span class="p">[</span><span class="n">alg</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span>
<span class="n">channels_needed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">channels_needed</span><span class="p">)</span>

<span class="n">rrdp_pos</span> <span class="o">=</span> <span class="n">rrdp_file</span><span class="o">.</span><span class="n">read_RRDP_files</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">ow_files</span><span class="p">,</span> <span class="n">ci_files</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="n">channels_needed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of OW samples:  15955
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of CI samples:  13441
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># boxes of lat/lon: (lat_min, lat_max, lon_min, lon_max)</span>
<span class="c1"># To simplify, we use lat/lon boxes here, but in an operational</span>
<span class="c1"># mode the region masks would be defined with more advanced geomasks.</span>
<span class="n">OW_box</span> <span class="o">=</span> <span class="p">(</span><span class="mf">73.</span><span class="p">,</span> <span class="mf">76.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="c1"># CI_box = (82.5, 88., 5, 50)</span>
</pre></div>
</div>
</div>
</div>
<p>Locate CIMR L1B files to use in the training (for the time being we only have 1 realistic swath, so we must use it. But in an operational context the offline training would access a rolling archive of past L1B data, typically 5-10 days.</p>
<p>To simplify, we only extract OW and CI samples from one swath file from the archive.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arch_l1b_fn_patt</span> <span class="o">=</span> <span class="s1">&#39;SCEPS_l1b_sceps_geo_polar_scene_1_unfiltered_tot_minimal_nom_nedt_apc_tot_v2p1.nc&#39;</span>
<span class="n">arch_l1b_fn_patt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l1b_archive_dir</span><span class="p">,</span> <span class="n">arch_l1b_fn_patt</span><span class="p">)</span>
<span class="n">arch_l1b_files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">arch_l1b_fn_patt</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arch_l1b_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING : did not find any good L1B file in the archive (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arch_l1b_fn_patt</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Do the training sample extraction and the storing into tie-point objects for each algorithm in turn (<code class="docutils literal notranslate"><span class="pre">CKA</span></code>, <code class="docutils literal notranslate"><span class="pre">KKA</span></code>, and <code class="docutils literal notranslate"><span class="pre">KA</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reload</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
<span class="k">for</span> <span class="n">algo</span> <span class="ow">in</span> <span class="n">algos</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;target_band&#39;</span><span class="p">]</span>
    <span class="n">bands_needed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">tb_dict</span><span class="p">[</span><span class="n">b</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">bands_needed</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">arch_l1b</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">CIMR_L1B</span><span class="p">(</span><span class="n">arch_l1b_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">keep_calibration_view</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">selected_bands</span><span class="o">=</span><span class="n">bands_needed</span><span class="p">)</span>
    
    <span class="c1"># if asked by the user, apply the (pre-computed) OZA adjustment fields for all bands</span>
    <span class="k">if</span> <span class="n">use_oza_adjust</span><span class="p">:</span>
        <span class="n">arch_l1b</span><span class="o">.</span><span class="n">apply_OZA_adjustment</span><span class="p">()</span>
    
    <span class="c1"># coarsen l1b samples along the scanlines with a kernel of 5 (horns are *not* combined)</span>
    <span class="n">arch_l1b</span> <span class="o">=</span> <span class="n">arch_l1b</span><span class="o">.</span><span class="n">coarsen_along_scanlines</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="c1"># collocate TBs to the target band of the algorithm.</span>
    <span class="k">if</span> <span class="n">algo</span> <span class="o">==</span> <span class="s1">&#39;KA&#39;</span><span class="p">:</span>
        <span class="c1"># we use only one frequency: no need for collocation</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">algo</span> <span class="o">==</span> <span class="s1">&#39;KKA&#39;</span><span class="p">:</span>
        <span class="c1"># the collocation is done along scanlines (to not mix feeds with different OZAs)</span>
        <span class="n">arch_l1b</span> <span class="o">=</span> <span class="n">arch_l1b</span><span class="o">.</span><span class="n">collocate_along_scan</span><span class="p">(</span><span class="n">target_band</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">algo</span> <span class="o">==</span> <span class="s1">&#39;CKA&#39;</span><span class="p">:</span>
        <span class="c1"># the collocation is done across scanlines and mixes feeds with different OZAs</span>
        <span class="c1">#    note : here we also mix forward and aft- scans which is maybe not optimal.</span>
        <span class="n">arch_l1b</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">collocate_channels</span><span class="p">(</span><span class="n">arch_l1b</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nn&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Collocation step missing for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="p">))</span>
    
    <span class="c1"># how to access the lat and lon depends on the collocation type</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arch_l1b</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">CIMR_L1B</span><span class="p">):</span>
        <span class="n">_lat</span> <span class="o">=</span> <span class="n">arch_l1b</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">lat</span>
        <span class="n">_lon</span> <span class="o">=</span> <span class="n">arch_l1b</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">lon</span>
    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">arch_l1b</span><span class="p">[</span><span class="s1">&#39;_type&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;L1C swath&#39;</span><span class="p">:</span>
        <span class="n">_lat</span> <span class="o">=</span> <span class="n">arch_l1b</span><span class="p">[</span><span class="s1">&#39;geolocation&#39;</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
        <span class="n">_lon</span> <span class="o">=</span> <span class="n">arch_l1b</span><span class="p">[</span><span class="s1">&#39;geolocation&#39;</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized L1 data type.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create the masks for OW and CI from the lat-lon boxes</span>
    <span class="n">_mask</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">_mask</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">_lat</span> <span class="o">&gt;</span> <span class="n">OW_box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">_lat</span> <span class="o">&lt;</span> <span class="n">OW_box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">_lon</span> <span class="o">&gt;</span> <span class="n">OW_box</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">_lon</span> <span class="o">&lt;</span> <span class="n">OW_box</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
    <span class="c1">#_mask[&#39;ci&#39;] = (_lat &gt; CI_box[0])*(_lat &lt; CI_box[1])*(_lon &gt; CI_box[2])*(_lon &lt; CI_box[3]).astype(&#39;int&#39;)</span>
    
    <span class="c1"># Prepare for extracting the training samples.We also store the feed number (e.g. 0-7 for KU/KA)</span>
    <span class="c1">#   to be able to later train algorithm for specific feeds.</span>
    <span class="n">dyn_tbs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">dyn_tbs</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="c1">#dyn_tbs[&#39;ci&#39;] = dict()</span>
    <span class="n">dyn_tbs_feed</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">dyn_tbs_feed</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#dyn_tbs_feed[&#39;ci&#39;] = None</span>
    
    <span class="c1"># Extract the brightness temperatures in the OW areas and store in sample dictionaries</span>
    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]:</span>
        <span class="c1"># for each input channel to the algorithm (e.g. tb19v), deduce the</span>
        <span class="c1">#   name of the variable to be read in the L1B (or L1C) data structure.</span>
        <span class="n">bn</span> <span class="o">=</span> <span class="n">tb_dict</span><span class="p">[</span><span class="n">ch</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arch_l1b</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">CIMR_L1B</span><span class="p">):</span>
            <span class="n">bnstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">bn</span> <span class="o">!=</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">bnstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bn</span><span class="p">)</span>
            <span class="n">tb_n</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">brightness_temperature_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bnstr</span><span class="p">,</span> <span class="n">pol</span><span class="p">)</span>
            <span class="c1"># read and apply the OW or CI mask</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ow&#39;</span><span class="p">,):</span>
                <span class="n">dyn_tbs</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="n">ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch_l1b</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="n">tb_n</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">_mask</span><span class="p">[</span><span class="n">w</span><span class="p">])</span><span class="o">.</span><span class="n">to_masked_array</span><span class="p">()</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
                <span class="c1"># keep the feed number information only for the target band</span>
                <span class="k">if</span> <span class="n">bn</span> <span class="o">==</span> <span class="n">b</span> <span class="ow">and</span> <span class="n">dyn_tbs_feed</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dyn_tbs_feed</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch_l1b</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="s1">&#39;orig_horn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">_mask</span><span class="p">[</span><span class="n">w</span><span class="p">])</span><span class="o">.</span><span class="n">to_masked_array</span><span class="p">()</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">arch_l1b</span><span class="p">[</span><span class="s1">&#39;_type&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;L1C swath&#39;</span><span class="p">:</span>
            <span class="n">tb_n</span> <span class="o">=</span> <span class="s1">&#39;brightness_temperature_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
            <span class="c1"># read and apply the OW or CI mask</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ow&#39;</span><span class="p">,):</span>
                <span class="n">dyn_tbs</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="n">ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch_l1b</span><span class="p">[</span><span class="n">bn</span><span class="o">+</span><span class="s1">&#39;_BAND&#39;</span><span class="p">][</span><span class="n">tb_n</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">_mask</span><span class="p">[</span><span class="n">w</span><span class="p">])</span><span class="o">.</span><span class="n">to_masked_array</span><span class="p">()</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
                <span class="c1"># keep the feed number information only for the target band</span>
                <span class="k">if</span> <span class="n">bn</span> <span class="o">==</span> <span class="n">b</span> <span class="ow">and</span> <span class="n">dyn_tbs_feed</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dyn_tbs_feed</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch_l1b</span><span class="p">[</span><span class="n">bn</span><span class="o">+</span><span class="s1">&#39;_BAND&#39;</span><span class="p">][</span><span class="s1">&#39;orig_horn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">_mask</span><span class="p">[</span><span class="n">w</span><span class="p">])</span><span class="o">.</span><span class="n">to_masked_array</span><span class="p">()</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized L1 data type.&quot;</span><span class="p">)</span>
            
    <span class="c1">#</span>
    <span class="c1"># TUNING COMBINING ALL FEEDS INTO ONE ALGORITHM</span>
    <span class="c1">#</span>
    
    <span class="c1"># Transfer the training data in a tie-point object. This involves some processing,</span>
    <span class="c1">#  like computing the tie-points and their covariance matrices. </span>
    <span class="n">ow_tp</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">OWTiepoint</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;CIMRL1B-ALLFEEDS&#39;</span><span class="p">,</span> <span class="n">tbs</span><span class="o">=</span><span class="n">dyn_tbs</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">])</span>
    <span class="n">ci_tp</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">CICETiepoint</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;rrdp&#39;</span><span class="p">,</span> <span class="n">tbs</span><span class="o">=</span><span class="n">rrdp_pos</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">])</span>
    <span class="n">ow_tp</span><span class="o">.</span><span class="n">instr</span> <span class="o">=</span> <span class="n">ci_tp</span><span class="o">.</span><span class="n">instr</span> <span class="o">=</span> <span class="s1">&#39;CIMR&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OW tie-point for </span><span class="si">{}</span><span class="s2"> ALLFEEDS: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">ow_tp</span><span class="o">.</span><span class="n">tp</span><span class="p">))</span>

    <span class="c1"># Tune the SIC algorithm on these tie-points</span>
    <span class="n">tuned_algo</span> <span class="o">=</span> <span class="n">hybrid_algo</span><span class="o">.</span><span class="n">HybridSICAlgo</span><span class="p">(</span><span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">],</span> <span class="n">ow_tp</span><span class="p">,</span> <span class="n">ci_tp</span><span class="p">)</span>

    <span class="c1"># Store the algorithm on disk (JSON file) for later re-use</span>
    <span class="n">json_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_sic_</span><span class="si">{}</span><span class="s1">.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">ow_tp</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp_out</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tuned_algo</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">fp_out</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">MyEncoder</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> SIC configuration file is in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">json_fn</span><span class="p">))</span>
    
    <span class="c1">#</span>
    <span class="c1"># TUNING SEPARATE ALGORITHMS, ONE FOR EACH FEED</span>
    <span class="c1">#</span>
    <span class="k">for</span> <span class="n">feed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">n_horns</span><span class="p">[</span><span class="n">b</span><span class="p">]):</span>
        <span class="n">FEEDNB</span> <span class="o">=</span> <span class="s1">&#39;FEED</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
        
        <span class="n">dyn_tbs_f</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">dyn_tbs_f</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1">#dyn_tbs_f[&#39;ci&#39;] = dict()</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ow&#39;</span><span class="p">,):</span>
                <span class="n">dyn_tbs_f</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="n">ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">dyn_tbs</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="n">ch</span><span class="p">][</span><span class="n">dyn_tbs_feed</span><span class="p">[</span><span class="n">w</span><span class="p">]</span><span class="o">==</span><span class="n">feed</span><span class="p">]</span>
        
        <span class="n">ow_tp</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">OWTiepoint</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;CIMRL1B-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FEEDNB</span><span class="p">),</span> <span class="n">tbs</span><span class="o">=</span><span class="n">dyn_tbs_f</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">])</span>
        <span class="n">ci_tp</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">CICETiepoint</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;CCI-RRDP&#39;</span><span class="p">,</span> <span class="n">tbs</span><span class="o">=</span><span class="n">rrdp_pos</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">])</span>
        <span class="n">ow_tp</span><span class="o">.</span><span class="n">instr</span> <span class="o">=</span> <span class="n">ci_tp</span><span class="o">.</span><span class="n">instr</span> <span class="o">=</span> <span class="s1">&#39;CIMR&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OW tie-point for </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">FEEDNB</span><span class="p">,</span> <span class="n">ow_tp</span><span class="o">.</span><span class="n">tp</span><span class="p">))</span>
        
        <span class="c1"># Tune the SIC algorithm on these tie-points</span>
        <span class="n">tuned_algo</span> <span class="o">=</span> <span class="n">hybrid_algo</span><span class="o">.</span><span class="n">HybridSICAlgo</span><span class="p">(</span><span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">],</span> <span class="n">ow_tp</span><span class="p">,</span> <span class="n">ci_tp</span><span class="p">)</span>

        <span class="c1"># Store the algorithm on disk (JSON file) for later re-use</span>
        <span class="n">json_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_sic_</span><span class="si">{}</span><span class="s1">.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">ow_tp</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp_out</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tuned_algo</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">fp_out</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">MyEncoder</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> SIC configuration file is in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">json_fn</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KA [&#39;KA&#39;]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Select every 10 CICE points
OW tie-point for KA ALLFEEDS: [139.41070898 210.85681807]
KA SIC configuration file is in ../data/aux/KA_sic_CIMRL1B-ALLFEEDS.json
OW tie-point for KA FEED0: [139.61863591 211.69713439]
KA SIC configuration file is in ../data/aux/KA_sic_CIMRL1B-FEED0.json
OW tie-point for KA FEED1: [139.56751169 211.45852874]
KA SIC configuration file is in ../data/aux/KA_sic_CIMRL1B-FEED1.json
OW tie-point for KA FEED2: [139.51613917 211.21867282]
KA SIC configuration file is in ../data/aux/KA_sic_CIMRL1B-FEED2.json
OW tie-point for KA FEED3: [139.430838   211.00187565]
KA SIC configuration file is in ../data/aux/KA_sic_CIMRL1B-FEED3.json
OW tie-point for KA FEED4: [139.39764262 210.75705817]
KA SIC configuration file is in ../data/aux/KA_sic_CIMRL1B-FEED4.json
OW tie-point for KA FEED5: [139.31441597 210.53854513]
KA SIC configuration file is in ../data/aux/KA_sic_CIMRL1B-FEED5.json
OW tie-point for KA FEED6: [139.26148008 210.29482339]
KA SIC configuration file is in ../data/aux/KA_sic_CIMRL1B-FEED6.json
OW tie-point for KA FEED7: [139.22752453 210.07996419]
KA SIC configuration file is in ../data/aux/KA_sic_CIMRL1B-FEED7.json
CKA [&#39;C&#39;, &#39;KA&#39;]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Select every 10 CICE points
OW tie-point for CKA ALLFEEDS: [157.37265068 139.3836527  210.74229595]
CKA SIC configuration file is in ../data/aux/CKA_sic_CIMRL1B-ALLFEEDS.json
OW tie-point for CKA FEED0: [158.14674602 139.40309565 210.74556295]
CKA SIC configuration file is in ../data/aux/CKA_sic_CIMRL1B-FEED0.json
OW tie-point for CKA FEED1: [157.65815072 139.40552123 210.81713763]
CKA SIC configuration file is in ../data/aux/CKA_sic_CIMRL1B-FEED1.json
OW tie-point for CKA FEED2: [157.12393649 139.41508237 210.83915549]
CKA SIC configuration file is in ../data/aux/CKA_sic_CIMRL1B-FEED2.json
OW tie-point for CKA FEED3: [156.65400841 139.31590842 210.57733599]
CKA SIC configuration file is in ../data/aux/CKA_sic_CIMRL1B-FEED3.json
KKA [&#39;KU&#39;, &#39;KA&#39;]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Collocate KA -&gt; KU along scan
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/thomasl/Work/DEVALGO/Tools/tools/io_handler.py:480: FutureWarning: The return type of `Dataset.dims` will be changed to return a set of dimension names in future, in order to be more consistent with `DataArray.dims`. To access a mapping from dimension names to lengths, please use `Dataset.sizes`.
  for feed in range(0,self.data[orig_band].dims[&#39;n_horns&#39;]):
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Select every 10 CICE points
OW tie-point for KKA ALLFEEDS: [182.34887517 139.40279549 210.85397525]
KKA SIC configuration file is in ../data/aux/KKA_sic_CIMRL1B-ALLFEEDS.json
OW tie-point for KKA FEED0: [183.2093201  139.60880568 211.69588408]
KKA SIC configuration file is in ../data/aux/KKA_sic_CIMRL1B-FEED0.json
OW tie-point for KKA FEED1: [182.96248328 139.5640257  211.45814876]
KKA SIC configuration file is in ../data/aux/KKA_sic_CIMRL1B-FEED1.json
OW tie-point for KKA FEED2: [182.73200623 139.50750784 211.21634999]
KKA SIC configuration file is in ../data/aux/KKA_sic_CIMRL1B-FEED2.json
OW tie-point for KKA FEED3: [182.4990057  139.42279606 210.99753822]
KKA SIC configuration file is in ../data/aux/KKA_sic_CIMRL1B-FEED3.json
OW tie-point for KKA FEED4: [182.24411856 139.39852843 210.75673674]
KKA SIC configuration file is in ../data/aux/KKA_sic_CIMRL1B-FEED4.json
OW tie-point for KKA FEED5: [181.99598277 139.2996849  210.53265552]
KKA SIC configuration file is in ../data/aux/KKA_sic_CIMRL1B-FEED5.json
OW tie-point for KKA FEED6: [181.7498074  139.25480565 210.29056396]
KKA SIC configuration file is in ../data/aux/KKA_sic_CIMRL1B-FEED6.json
OW tie-point for KKA FEED7: [181.58978474 139.21410147 210.07206771]
KKA SIC configuration file is in ../data/aux/KKA_sic_CIMRL1B-FEED7.json
</pre></div>
</div>
</div>
</div>
<p>At the end, we also run a tuning of each algorithm against the static set of SIC0 and SIC1 data points
from the ESA CCI Round Robin Data Package (AMSR-E + AMSR2 TBs). This would not be used in the operational processing, but is used now to demonstrate the impact of dynamic tuning of the algorithms in the Performance Assessment chapter.</p>
<p>the training data are taken from the ESA CCI Sea Ice Concentration Round Robin Data Package of Pedersen et al. (2019). The relevant data files as well as routines to parse the files are stored in module siddrp/.</p>
<p>Pedersen, Leif Toudal; Saldo, Roberto; Ivanova, Natalia; Kern, Stefan; Heygster, Georg; Tonboe, Rasmus; et al. (2019): Reference dataset for sea ice concentration. figshare. Dataset. <a class="reference external" href="https://doi.org/10.6084/m9.figshare.6626549.v7">https://doi.org/10.6084/m9.figshare.6626549.v7</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run the tuning for each algorithm in turn</span>
<span class="k">for</span> <span class="n">algo</span> <span class="ow">in</span> <span class="n">algos</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    
    <span class="c1"># Transfer the training data in a tie-point object. This involves some processing,</span>
    <span class="c1">#  like computing the tie-points and their covariance matrices. </span>
    <span class="n">ow_tp</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">OWTiepoint</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;rrdp&#39;</span><span class="p">,</span> <span class="n">tbs</span><span class="o">=</span><span class="n">rrdp_pos</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">])</span>
    <span class="n">ci_tp</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">CICETiepoint</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;rrdp&#39;</span><span class="p">,</span> <span class="n">tbs</span><span class="o">=</span><span class="n">rrdp_pos</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">])</span>
    <span class="n">ow_tp</span><span class="o">.</span><span class="n">instr</span> <span class="o">=</span> <span class="n">ci_tp</span><span class="o">.</span><span class="n">instr</span> <span class="o">=</span> <span class="s1">&#39;AMSRs&#39;</span>
    <span class="n">ow_tp</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">ci_tp</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;CCI-RRDP&#39;</span>
    
    <span class="c1"># Tune the SIC algorithm on these tie-points</span>
    <span class="n">tuned_algo</span> <span class="o">=</span> <span class="n">hybrid_algo</span><span class="o">.</span><span class="n">HybridSICAlgo</span><span class="p">(</span><span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">],</span> <span class="n">ow_tp</span><span class="p">,</span> <span class="n">ci_tp</span><span class="p">)</span>
    
    <span class="c1"># Store the algorithm on disk (JSON file) for later re-use</span>
    <span class="n">json_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_sic_</span><span class="si">{}</span><span class="s1">.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">ow_tp</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp_out</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tuned_algo</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">fp_out</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">MyEncoder</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> SIC configuration file is in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">json_fn</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Select every 1 OW points
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Select every 10 CICE points
KA SIC configuration file is in ../data/aux/KA_sic_CCI-RRDP.json
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Select every 1 OW points
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Select every 10 CICE points
CKA SIC configuration file is in ../data/aux/CKA_sic_CCI-RRDP.json
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Select every 1 OW points
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Select every 10 CICE points
KKA SIC configuration file is in ../data/aux/KKA_sic_CCI-RRDP.json
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./algorithm"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../book/algorithm_input_output_data_definition.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Algorithm Input and Output Data Definition (IODD)</p>
      </div>
    </a>
    <a class="right-next"
       href="CIMR_L2_Sea_Ice_Concentration_algorithm.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">A Level-2 Sea Ice Concentration (SIC) and Sea Ice Edge (SIED) algorithm for CIMR</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Thomas Lavergne, Norwegian Meteorological Institute
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
This ATBD was developed in the context of the ESA-funded CIMR DEVALGO study (2022-2024) (contract 4000137493).
<br>
ESA is not responsible in any way for the content of this document.
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>